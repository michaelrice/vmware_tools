[{"Content": "#!/usr/bin/env bash\n\n#!/usr/local/bin/env bash\n# Helper to setup DRP tasks for other templates\n#\n###\n#  This is a BASH script snippet intended to be run inside other BASH templates.\n#\n#  Simple helper to prep a system with DRPCLI and JQ.  If not already installed,\n#  download and install the `drpcli` and `jq` binaries in /usr/local/bin and then\n#  source our `helper` tools\n#\n#  To use this in other templates, simply specify:\n#\n#         \\{\\{template \"setup.tmpl\" .\\}\\}\n#\n#  without the backslashes.\n###\n\nset -e\n\nfunction xiterr() { [[ $1 =~ ^[0-9]+$ ]] && { XIT=$1; shift; } || XIT=1; echo \"FATAL: $*\";  __exit $XIT; }\n\n###\n#  if we want debugging of our scripts, set the Param to true\n#  also set shell variable for script reuse if desired for further\n#  debugging\n###\n\n\n\n\n# We pretty much always need these parameters set, but\n# don't overwrite them if they already exist.\n[[ $RS_TOKEN ]] || export RS_TOKEN=\"gUjuwMhCN_VY_hVQdMV1ZigJMPtwsbSSPgHoHDJs4BQhpVRAMx5lPQoQXL5zMfA_Ju-a4nJW7Yt1gEAL3rb6WiCPeRZ9JL6n1-Jh1hdKb54b64GIb-pOmSVY-btPyaK1rikqWL1u4A4gp-cCIUf6S6pae6bWBFb06YRAWZtGDsWEe6H097skxvpZbJbcwiWUnllQy4XpLCy1v4z6dhFqoX-A44Sp7a8oEmR3vx4vGfyXerFkvbMArphhalHLgaKKawoxwwBGtYyNpuegR1ZVfspO4EqNnCA-T22uIIZ3M5S2TZOWJClYonQeKoFMHoCqunFz8GIco6sqQloKZnv0Vgb5QmyzrhaXouvGDgN0dP1eLYVnijg1ynJJO4RRIvu_qxyEmDE8zk33YksXU6fxUAjtcpAchOc_YBv148Lg85FUIlF5XjFl2iNJ01UQmP_-X0wNFDvVn6Oilrcuwp0WVyHE98iWlPabkumVaLHYIce4LbxSxrnonrlGN-hONsRTwJoolGZMqIRqknlscdYwv1alE0D__niwlljOiiDAxBrw1FcTv5tu2dQX5moBmhUEd-hjjILRKJt4W1uUyKJQO7XR1TBxE4Q4fXZ_Vo2aAFyQaZi1eTQ3tOPSz1lxEaaSEE1XA2wGkPP2Wug7eSzVSofB5nmQxsbBd8LFZhGBvQcA2sgykPyusW6hZsml8zEXRrv0exbeDa1nEOfDHzNw03macjFzv8K4RhoTxnowXTB8Tm8yN6PB6gYf-ZYlYu7zPIwYHGEZ0FWMYmdxA06vRjJrFsmvTjgW4izD7irc4PMe5PJK6a_ypkbYECV6WAeKCNHu0wvaGO7KBQFKMGUEo16WK_Z5iDBtjDLH3mFxNTpso0E8JI15QXa5CkrsSd5avJrftUoWS5LZrGKPZJ-4dbde652y5iRtBmvk7I7iu9ExPzZCB1_Uwzjpmmjqp3E_zltS8FcBYKYEH6Rb0T7AD4rd-mKyOUsYYbsss3WsyBeeUwwzwj_o-wzhNXir2LvAGDaIxCmOprO7dny6IefV-hxvIWQup1TkugZTE2SMnyqH4NqepYQUoaJh71f0EzkdKi1isSqlVt9zPyUF_n3573y19peNuXNB5qBbtdcRWcbZuH8RxgByyF5eVjkQdSOwjsP515hKHBB6m46dpG1qcAxDms7qUUFULClkbWXU2KAjGFD9P3yPWY0WyJ40nzAf-l1vei7WuzTj6qkSx9IMX-Gkj3xBW97_BqSId6hKz7d8K2isXZSlXb5H5RtewrBO9LSNdy5z0-7NaubC1yhq9QMgG5SSpxP4O99wP3pQU-ONFLvPjgkxJfnpCO2_SN3uwr-OaT_M7UvaV7aAp09ncaJCGlmMeGM2stZT8qbFP-T9YsJmrpIU_MuwWPQemq6nATSaFQrORp4tR2BB5qAgp7FgVscimoPVwrY81WwlXtfRWcQt1qcQqqtD6m-P7APbeYXaFNOrX7dBxq88WeZiQ1oZCUjNhEUUCc-0RleQQ0JpNkqIJsbuyEfuZXWa51Nm3LKlENO0GU5cAjuLERSTFlXjEmKtStOWsfFrl6PIGsa38bAlHge36kchEgty1JZ7LI_NLkf-9UvSsbpPGN4uJSeQxBufqt8xsxGpYogvjHhZK_uHPQbl7kqs7HtOK2syNDyujQ9wEofqHv89B_mYl_4WwJU1vSN-5xMP4KyacSRLXUqMl_FAlQ4b19xWqrXHf6nBNJNDaAOPcvxv52chTRuKu7ksgkvhKneQVOluKs24sHrGgc3h9FdkR3J15JannU0X4MZbEyXoQ5ZCcQw1_-EBh12h1c0KANz3GJqy-otynldmeRH_FroEzuZZFcrcUWT8paU9kELry-PB2mTHqQJQj9RC3R1Yx5KoyX1nD77cAzvURciu1jCpbjgarZUtI1NE1bcL21ufIpwA_D9IfAjDz6A1vomjlnooUPP8lO7Ynwhz2G5sVLwZwgcDvukPLCfNHZYgWEZSlXvsu3JTQdyqQftkTp0G4yiGG0LneA7vGxXy_swIn9VdPVxaTmcUfG4w9gtEyAxOXZKufsO5EO_bOenSl5N-cXxFJMiHw4yuv4rcJj3JPZpQCIURQ_v31KINK8b9bb9sUlQJ8Ui8ejsspfg_Wb-YvW-TnQp19i5rpxIn-WfGNhsauyESolY86aGHyQJLFY9VWV3f11WK86j-dn42WVDZk1WRlN6fDv2Jf1IQVx_NfudD3yddK9oSMgCEHg__f2WXnizJSYL9PlngZszevXhRNAobDGOOnOGbyRWGpeQCJbtGAYd48ej2T85m857ffv2Wsta_NaShcGNc46EXx9iTWJ63C_GruKBneOJsiKEuZqmTfnamXxtRcQHIjTkBDYz9dKMd2U5A2vVndpkC5CAJh5nIdU185gqwyrTMK4WeRlK81J3icaHN3F9JCDU2o07zVvcraQ==\"\n[[ $RS_ENDPOINT ]] || export RS_ENDPOINT=\"https://10.0.0.1:8092\"\n[[ $RS_UUID ]] || export RS_UUID=\"f45fbc79-4081-4f27-86e4-bbf9d3757fd4\"\n\nfunction fixup_path() {\n  local _add_path\n  for _add_path in $(echo $* | sed 's/[:,]/ /g')\n  do\n    mkdir -p $_add_path\n    # inject colons to avoid partial match failures\n    grep -q \":$_add_path\" <<< \":$PATH:\" || export PATH=\"$PATH:$_add_path\"\n  done\n}\n\nfixup_path /usr/local/bin /usr/sbin /sbin /opt/bin\n\narch=$(uname -m)\ncase $arch in\n    x86_64|amd64) arch=\"amd64\";;\n    arm64|aarch64) arch=\"arm64\";;\n    *)\n        xiterr 1 \"Unknown arch $(uname -m)\";;\nesac\n\nINSTALL_DIR=/usr/local/bin\nif grep -q coreos /etc/os-release ; then\n  INSTALL_DIR=/opt/bin\nfi\nmkdir -p $INSTALL_DIR\n\n# TODO: we need to make drpcli/jq grab smarter to be a little\n#       more tolerant of OS arch/type - and grab the right one\nfor tool in drpcli jq; do\n    which \"$tool\" &>/dev/null && continue\n    echo \"Installing $tool in $INSTALL_DIR\"\n    case $tool in\n        drpcli) curl -gsfLo \"$INSTALL_DIR/$tool\" \"http://10.0.0.1:8091/files/drpcli.$arch.linux\";;\n        jq)     curl -gsfLo \"$INSTALL_DIR/$tool\" \"http://10.0.0.1:8091/files/jq\";;\n    esac\n    chmod 755 \"$INSTALL_DIR/$tool\"\ndone\nunset tool\nunset INSTALL_DIR\n\nif [[ -r ./helper ]]; then\n    . ./helper\n    __sane_exit\nfi\n\n\necho \"Skipping sledgehammer enforcement\"\ndrpcli machines update $RS_UUID '{ \"OS\": \"centos-7\" }' 2>/dev/null >/dev/null\nexit 0\n", "Path": "", "Meta": {}, "Name": "enforce-sledgehammer"}]